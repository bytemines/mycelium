# Dependency Upgrade Report — 2026-02-08

## Summary

Full dependency upgrade across all packages. All builds, typechecks, and 471 tests passing.

## Node.js

| Before | After | Why |
|--------|-------|-----|
| >=20 | **>=22** | LTS, stable built-in fetch, better ESM support, V8 performance gains |

## Build Tooling

| Package | Before | After | Key Benefits |
|---------|--------|-------|-------------|
| TypeScript | 5.7.2 | **5.9.3** | Better type inference, faster tsc, isolated declarations |
| Turborepo | 2.3.3 | **2.8.3** | Improved caching, daemon stability, faster task scheduling |
| Prettier | 3.4.2 | **3.8.1** | New formatting rules, TypeScript 5.9 support |
| pnpm | 9.15.0 | **10.29.1** | New lockfile format, better security (approve-builds), improved resolution |
| Vitest | 2.1.8 | **4.0.18** | Browser mode improvements, better TypeScript support, faster test runner |
| Vite | 6.0.7 | **7.3.1** | Environment API, Rolldown integration, faster builds |

## Runtime Dependencies

| Package | Before | After | Key Benefits |
|---------|--------|-------|-------------|
| Zod | 3.24.1 | **4.3.6** | 14x faster parsing, 2x smaller bundle, Zod Mini variant |
| Commander | 13.0.0 | **14.0.3** | Improved TypeScript types, option parsing improvements |
| React | 18.3.1 | **19.2.4** | Actions, useOptimistic, use() hook, Server Components ready |
| React DOM | 18.3.1 | **19.2.4** | Document metadata, stylesheet support, ref as prop |
| @xyflow/react | 12.4.3 | **12.10.0** | New edge types, performance improvements, better a11y |
| Zustand | 5.0.11 | 5.0.11 | Already latest |
| Express | 5.2.1 | 5.2.1 | Already latest |
| yaml | 2.6.1 | **2.8.2** | Bug fixes, better YAML 1.2 compliance |
| lucide-react | 0.469.0 | **0.563.0** | New icons, tree-shaking improvements |

## Dashboard-Specific

| Package | Before | After | Key Benefits |
|---------|--------|-------|-------------|
| Tailwind CSS | 3.4.17 | **4.1.18** | CSS-first config, Oxide engine (10x faster), smaller output |
| tailwind-merge | 2.6.0 | **3.4.0** | TW4 compatibility, better class merging |
| @vitejs/plugin-react | 4.3.4 | **5.1.3** | Vite 7 compatibility, React 19 support |
| jsdom | 25.0.1 | **28.0.0** | Better DOM compliance, Node 22 support |
| Radix UI | various | patched | Bug fixes across dialog, dropdown, tooltip, slot |
| @testing-library/react | 16.1.0 | **16.3.2** | React 19 compatibility, improved queries |

## Dev Types

| Package | Before | After |
|---------|--------|-------|
| @types/node | 22.10.5 | **25.2.2** |
| @types/react | 18.3.18 | **19.2.13** |
| @types/react-dom | 18.3.5 | **19.2.3** |
| @types/express | 5.0.6 | 5.0.6 |

## Breaking Changes Fixed

### Zod 4
- `z.record()` now requires explicit key schema: `z.record(z.string(), valueSchema)`
- Fixed 4 occurrences in `packages/core/src/schema.ts`

### Tailwind CSS 4
- Migrated from JS config (`tailwind.config.js`) to CSS-based config (`@theme` in `index.css`)
- PostCSS plugin moved to `@tailwindcss/postcss`
- Removed `autoprefixer` (built into TW4)
- `@tailwind base/components/utilities` replaced with `@import "tailwindcss"`

### pnpm 10
- New `onlyBuiltDependencies` in package.json for build script approval
- Added `esbuild` to approved builds list

### React 19
- `act()` warnings in tests (non-blocking, tests still pass)
- `@types/react` and `@types/react-dom` bumped to v19

## Codebase Audit Findings

**240 files, 25,443 lines — Verdict: PASS (with minor issues)**

| Check | Core | CLI | Dashboard |
|-------|------|-----|-----------|
| Solves Problem | PASS | PASS | PASS |
| Lean | PASS | WARN | PASS |
| DRY | PASS | WARN | PASS |
| Aligned | PASS | PASS | PASS |
| Not Over-engineered | PASS | PASS | PASS |
| Permanent Fix | PASS | WARN | PASS |

### Issues (priority order)

1. **P1 — Bug**: `preset load` prints actions but doesn't execute enable/disable (`preset.ts:46-73`)
2. **P2 — DRY**: Duplicate `TOOL_MAX_LINES` map in `runner.ts:76` and `memory-scoper.ts:162`
3. **P3 — Size**: `tool-adapter.ts` at 674 lines — 4 JSON adapters share near-identical read/modify/write patterns
4. **P5 — Platform**: `watcher.ts` still uses `recursive:true` (unsupported on Linux)
5. **P7 — Silent catches**: `MarketplaceBrowser.tsx:48,54` and `init.ts:431,447` swallow errors

### Resolved

- **Graph.tsx** — was ~600 lines, now 244 lines (extracted to `graph-builder.ts` + node components)

### Strengths

- Well-structured monorepo with clean separation
- 471 tests with co-located test files
- Consistent `AdapterResult` error handling pattern
- Zod schemas in core, TypeScript strict throughout
- Overlay sync preserves user config
- No security issues — `execFileSync`/`execFile` used correctly

## Future Upgrades (not yet applied)

- **Radix UI unified package** — Migrate from `@radix-ui/react-*` to single `radix-ui` package (tree-shakable, cleaner imports)
- **React 19 features** — Adopt Actions API, `use()` hook, React Compiler when stable
- **TypeScript 5.9 `import defer`** — Experiment with deferred imports for CLI startup speed

## Verification

```
pnpm build      ✅ All 3 packages
pnpm typecheck  ✅ All 3 packages
pnpm test       ✅ 471 tests passing
```
